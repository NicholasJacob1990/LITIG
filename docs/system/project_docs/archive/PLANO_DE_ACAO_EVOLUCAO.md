### **Plano de Ação: Evolução da Plataforma de Advocacia (Revisado Pós-v2.3)**

**Objetivo Geral:** Alinhar o frontend, backend e banco de dados com a especificação completa de análise de currículos, conectar as funcionalidades existentes e implementar os recursos ausentes, **aproveitando o algoritmo v2.3 já implementado no backend.**

---

## **Sprint 1: Conexão e Enriquecimento Acelerado do Frontend**

*   **Duração:** 2 semanas
*   **Meta Principal:** Tornar o frontend totalmente funcional com os dados reais do backend e enriquecer a tela de perfil do advogado com informações já processadas, **incluindo o novo status de verificação de êxito**.

| User Story | Tarefas Técnicas | Documentação Associada |
| :--- | :--- | :--- |
| **Como usuário, quero ver uma lista real de advogados baseada em meus filtros para que eu possa encontrar profissionais relevantes.** | **1. Remover Dados Mocados (2h):** <br> • Arquivo: `app/(tabs)/advogados.tsx` <br> • Remover array `mockLawyers` e lógica de simulação <br> • Remover timeout artificial de 1000ms <br> **2. Integrar Hook useLawyers (4h):** <br> • Arquivo: `app/(tabs)/advogados.tsx` <br> • Substituir `setLawyers(mockLawyers)` por `useLawyers(filters)` <br> • Implementar estado de loading baseado no hook <br> • Tratar erros retornados pelo hook <br> **3. Conectar Filtros (6h):** <br> • Arquivo: `app/(tabs)/advogados.tsx` <br> • Mapear estado `selectedAreas` para parâmetro `area` do hook <br> • Mapear estado `minRating` para parâmetro `rating_min` do hook <br> • Mapear estado `availableNow` para parâmetro `is_available` do hook <br> • Implementar filtro de distância via `useNearbyLawyers` <br> **4. Implementar Estados de UI (3h):** <br> • Arquivo: `app/(tabs)/advogados.tsx` <br> • Criar componente `LoadingLawyers` para estado de carregamento <br> • Criar componente `ErrorLawyers` para estado de erro <br> • Criar componente `EmptyLawyers` para quando não há resultados <br> • Implementar retry automático em caso de erro <br> **5. Testes de Integração (3h):** <br> • Arquivo: `__tests__/advogados.test.tsx` <br> • Testar carregamento de dados reais <br> • Testar funcionamento de filtros <br> • Testar estados de loading e erro <br> • Testar performance com dados reais | • Atualizar `README.md` do `app/(tabs)`. |
| **Como usuário, quero ver a formação, as publicações e o status de verificação de um advogado para tomar uma decisão mais informada.** | **1. Aprimorar a Tela de Detalhes (`lawyer-details.tsx`):** <br> • Adicionar seção "Formação Acadêmica". <br> • Criar seção "Publicações e Certificações". <br> • **(Nova Tarefa)** Adicionar um selo/indicador visual para o `success_status` (ex: "Êxito Verificado") próximo à "Taxa de Sucesso". <br> • Garantir que o `LawyerService` e o `useLawyer` busquem todos os novos campos. | • Documentar os novos componentes de UI. <br> • Adicionar o `success_status` ao dicionário de dados da API. |
| **Como administrador, quero registrar a data de inscrição na OAB para ter um critério mais preciso de senioridade.** | **1. Criar Migração de Banco (1h):** <br> • Arquivo: `supabase/migrations/YYYYMMDD_add_oab_inscription_date.sql` <br> ```sql <br> -- Adicionar coluna de data de inscrição na OAB <br> ALTER TABLE public.lawyers <br> ADD COLUMN IF NOT EXISTS oab_inscription_date date; <br> <br> -- Criar índice para consultas por data <br> CREATE INDEX IF NOT EXISTS idx_lawyers_oab_inscription_date <br> ON public.lawyers (oab_inscription_date); <br> <br> -- Comentário da coluna <br> COMMENT ON COLUMN public.lawyers.oab_inscription_date <br> IS 'Data de inscrição do advogado na OAB'; <br> ``` <br> **2. Atualizar Schema da API (1h):** <br> • Arquivo: `backend/api/schemas.py` <br> • Adicionar campo `oab_inscription_date: Optional[date]` ao schema `LawyerSchema` <br> • Atualizar validações se necessário <br> **3. Atualizar Tipos Frontend (1h):** <br> • Arquivo: `lib/hooks/useLawyers.ts` <br> • Adicionar `oab_inscription_date?: string` à interface `Lawyer` <br> • Atualizar queries para incluir o novo campo <br> **4. Exibir no Frontend (2h):** <br> • Arquivo: `app/(tabs)/lawyer-details.tsx` <br> • Adicionar campo na seção de métricas principais <br> • Calcular anos de inscrição: `new Date().getFullYear() - new Date(oab_inscription_date).getFullYear()` <br> • Formatar data para exibição (DD/MM/AAAA) <br> **5. Testes de Migração (1h):** <br> • Arquivo: `tests/test_migrations.py` <br> • Testar aplicação da migração <br> • Testar rollback da migração <br> • Testar integridade dos dados | • Adicionar a descrição do novo campo no dicionário de dados do banco. |

---

## **Sprint 2: Infraestrutura para o Módulo de Equidade (β-Layer)**

*   **Duração:** 2 semanas
*   **Meta Principal:** Implementar a **infraestrutura de coleta de dados** (BD, API e UI) para alimentar o algoritmo de equidade (β-layer) que **já existe e foi expandido no backend**.

| User Story | Tarefas Técnicas | Documentação Associada |
| :--- | :--- | :--- |
| **Como advogado(a), quero poder informar voluntariamente meus dados de gênero, etnia, orientação sexual e se sou PCD para participar de iniciativas de diversidade.** | **1. Coleta de Dados de Equidade:** <br> • **DB:** Criar e executar a migração para adicionar as colunas `gender`, `ethnicity`, `pcd`, **`orientation`** na tabela `lawyers`. <br> • **Backend:** Desenvolver os endpoints na API (`/api/lawyers/me/equity`) para que um advogado possa salvar/atualizar seus dados de equidade. <br> • **Frontend:** Criar uma nova tela de configurações ou uma seção no perfil do advogado com um formulário para a submissão voluntária desses dados, incluindo o novo campo de orientação. A UI deve ser clara sobre o propósito e a opcionalidade. <br> • **Segurança:** Garantir que os dados sejam tratados como sensíveis, com políticas de acesso restritas (RLS no Supabase) e logs de auditoria. | • Criar um documento `EQUITY_MODULE.md` explicando a finalidade dos dados, a base legal (consentimento) e **como o algoritmo expandido já implementado os utiliza**. <br> • Atualizar a documentação da API com os novos endpoints e campos. |
| **Como plataforma, quero garantir que os dados de diversidade sejam corretamente passados para o algoritmo de match.** | **2. Integração dos Dados de Equidade:** <br> • **Backend:** Garantir que os dados de `DiversityMeta` (incluindo **`orientation`**) sejam carregados e passados corretamente para o `MatchmakingAlgorithm`. <br> • **Testes:** Criar testes de integração que verifiquem se um advogado com dados de diversidade preenchidos (gênero, etnia, pcd, orientação) recebe o "boost" de equidade corretamente, conforme a lógica já existente. | • Detalhar o fluxo de dados do `DiversityMeta` desde o banco até o algoritmo no `EQUITY_MODULE.md`. |
| **(Opcional) Como usuário, quero poder filtrar por advogados que participam de iniciativas de diversidade.** | **3. Filtro de Diversidade (Opcional):** <br> • **Frontend:** Adicionar um filtro na tela de busca que permita aos clientes encontrar advogados que se identificam com um ou mais grupos de diversidade (sem revelar qual). | • Adicionar a descrição do filtro à documentação da API. |

---

## **Sprint 3: Refinamento Técnico e Otimização da Análise de CV**

*   **Duração:** 2 semanas
*   **Meta Principal:** Otimizar a performance das buscas por similaridade e melhorar a qualidade dos dados extraídos dos currículos, pagando dívidas técnicas e preparando o sistema para escalar.

| User Story | Tarefas Técnicas | Documentação Associada |
| :--- | :--- | :--- |
| **Como desenvolvedor, quero que as buscas por similaridade de currículo sejam mais rápidas para melhorar a experiência do usuário.** | **1. Migrar Embeddings para `pgvector`:** <br> • **DB:** Adicionar uma coluna `cv_embedding` do tipo `vector(384)` na tabela `lawyers` e criar um índice IVFFlat. <br> • **Backend:** Criar um script de migração para mover os embeddings do campo JSONB `cv_analysis` para a nova coluna. <br> • **Backend:** Refatorar o `nlp_cv_embed.py` e o `algoritmo_match.py` para usar a nova coluna, aproveitando as buscas nativas do `pgvector`. | • Atualizar a documentação da arquitetura (`ARQUITETURA_SISTEMA.md`) para refletir o uso do `pgvector` na tabela `lawyers`. |
| **Como cientista de dados, quero dados mais estruturados sobre formação e experiência para melhorar a precisão do scoring.** | **2. Estruturar Dados do Currículo:** <br> • **DB:** Alterar os tipos das colunas `education` e `professional_experience` de `text[]` para `jsonb`. <br> • **Backend:** Modificar o `nlp_cv_embed.py` para extrair e salvar os dados em um formato JSON estruturado. <br> • **Frontend:** Atualizar a tela de detalhes do advogado para renderizar os dados a partir da nova estrutura JSON. | • Atualizar o dicionário de dados com os novos schemas JSON para `education` e `professional_experience`. |
| **Como plataforma, quero capturar mais detalhes sobre o advogado, como os tipos de cliente que atende.** | **3. Adicionar Campo "Tipos de Cliente":** <br> • **DB:** Adicionar a coluna `client_types` (`text[]`) na tabela `lawyers`. <br> • **Backend:** Integrar a extração desse dado no `nlp_cv_embed.py`. <br> • **Frontend:** Adicionar o campo na UI de perfil e nos filtros. | • Atualizar a documentação da API e o dicionário de dados. | 